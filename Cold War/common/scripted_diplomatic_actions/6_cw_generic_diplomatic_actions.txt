scripted_diplomatic_actions = {
	cw_stop_military_aid = {
		icon = 25
		allowed = {		#The country making the diplomatic request
			always = yes
		}
		visible = {		#The target country
			is_in_array = {
				array = ROOT.military_aid_countries_array
				value = FROM.id
			}
		}
		selectable = {
			custom_trigger_tooltip = {
				tooltip = "Is receiving military aid from us."
				FROM = {
					is_in_array = {
						array = ROOT.military_aid_countries_array
						value = THIS
					}
				}
			}
			hidden_trigger = {
				ROOT = { NOT = { has_country_flag = did_diplomatic_action_bribe } }		#Used to suspend request spam by AI	
			}
		}
		can_be_accepted = {
			always = yes
		}
		can_be_sent = {
			always = yes
		}

		send_description = CW_CANCEL_MILITARY_AID_LOC
		accept_title = CW_CANCEL_MILITARY_AID_TITLE
		accept_description = CW_CANCEL_MILITARY_AID_DESC
		
		cost = 0

		requires_acceptance = no

		on_sent_effect = {
			if = {
				limit = {
					ROOT = { is_ai = yes }
				}
				ROOT = { set_country_flag = { flag = did_diplomatic_action value = 1 days = 30 } }			
			}		
		}
		complete_effect = {
			cw_suspend_military_aid_diplomatic_action = yes
		}
		ai_desire = {
			base = 0
			modifier = {		#We dont give aid to countries that are at war with us
				ROOT = { has_war_with = PREV }
				add = 100
			}
			modifier = {		#We dont give aid to countries that are at war with us
				FROM = { has_war = no }
				add = 100
			}		
			modifier = {
				AND = {
					FROM = { tag = PRC }
					PRC = { has_completed_focus = PRC_crush_the_kuomintang }
				}
				add = -100
			}
			modifier = {
				is_in_array = {
					array = ROOT.priority_countries
					value = FROM.id
				}
				add = -500
			}			
		}
	}
	
	cw_recognize_government = {
		icon = 25
		visible = {		#The target country
			ROOT = { OR = { has_country_flag = democratic_leader_flag has_country_flag = communist_leader_flag } }
			has_idea = cw_non_recognized_state
			NOT = { has_war_with = ROOT }
			PREV = { similar_ideology_check = yes }
		}
		selectable = {
			hidden_trigger = {
				ROOT = { NOT = { has_country_flag = did_diplomatic_action_bribe } }		#Used to suspend request spam by AI	
			}
			NOT = { has_war_with = ROOT }
		}
		can_be_accepted = {
			always = yes
		}
		can_be_sent = {
			always = yes
		}

		send_description = CW_RECOGNIZE_GOV_LOC
		accept_title = CW_RECOGNIZE_GOV_TITLE
		accept_description = CW_RECOGNIZE_GOV_DESC
		
		cost = 100

		requires_acceptance = no

		on_sent_effect = {
		}
		complete_effect = {
			if = {
				limit = {
					ROOT = { is_ai = yes }
				}
				ROOT = { set_country_flag = { flag = did_diplomatic_action value = 1 days = 30 } }
			}
			cw_make_recognized = yes
			add_opinion_modifier = { target = ROOT modifier = recognized_government }
		}
		ai_desire = {
			base = 10
			modifier = {
				ROOT = { has_opinion = { target = PREV value > 30 } }
				add = 10
			}
			modifier = {
				has_political_power < 200
				add = -1000
			}			
			modifier = {
				has_government = ROOT
				add = 20
			}
			modifier = {
				similar_ideology_check = yes
				add = 10
			}
			modifier = {
				same_ideology_check = yes
				add = 30
			}
			modifier = {
				similar_ideology_check = no
				add = -100
			}
			modifier = {
				tag = CGR
				ROOT = { tag = SOV }
				add = -500
			}
			modifier = {
				add = 200
				FROM = {
					is_in_array = {
						array = ROOT.priority_countries
						value = THIS.id
					}
				}
			}			
		}
	}
	cw_unconditional_surrender = {
		icon = 28
		allowed = {
		}
		visible = {
			ROOT = {
				OR = {
					is_puppet = no
					is_subject = no
				}
				OR = {
					is_ai = no 
					tag = FRA
					tag = HOL
				}
			}
			OR = {
				AND = {
					has_war_with = ROOT
					is_in_faction = no
				}
				AND = {
					has_war_with = ROOT
					is_in_faction = yes
					is_faction_leader = yes
				}				
			}
		}
		
		selectable = {
			NOT = { has_civil_war = yes }
			NOT = { has_idea = unstable_government }
			OR = {
				ROOT = { surrender_progress > 0.50 }
				custom_trigger_tooltip = {
					tooltip = CW_UNCONDITIONAL_TRUCE_TRIGGER_WE_TT
					ROOT = { check_variable = { war_exaustion_effect < -0.10 } }
				}
			}			
		}
		can_be_accepted = {
			always = yes
		}
		can_be_sent = {
			always = yes
		}

		send_description = CW_UNCONDITIONAL_SURRENDER_LOC
		receive_description = CW_UNCONDITIONAL_SURRENDER_LOC_RECIEVER_LOC
		accept_title = CW_UNCONDITIONAL_SURRENDER_ACCEPTED_TITLE
		accept_description = CW_UNCONDITIONAL_SURRENDER_ACCEPTED_DESC
		reject_title = CW_UNCONDITIONAL_SURRENDER_REJECTED_TITLE
		reject_description = CW_UNCONDITIONAL_SURRENDER_REJECTED_DESC

		requires_acceptance = yes
		show_acceptance_on_action_button = yes

		on_sent_effect = {
			if = {
				limit = {
					ROOT = { is_ai = yes }
				}
				ROOT = { set_country_flag = { flag = did_diplomatic_action value = 1 days = 30 } }
			}
			if = {		# Has to be done this way since game refuses to read variable twin_country from FROM tag.
				limit = {
					has_variable = twin_country
					has_war_with = var:twin_country
					var:twin_country = {
						OR = {
							is_puppet_of = ROOT 
							is_subject_of = ROOT
						}
					}
				}
				var:twin_country = { ROOT = { PREV = { save_event_target_as = country_to_show } } }
				ROOT = { set_variable = { country_name_to_show = event_target:country_to_show } }
			}
		}
		complete_effect = {
			ROOT = {
				every_owned_state = {
					limit = {
						OR = {
							is_claimed_by = PREV.PREV
							is_core_of = PREV.PREV
						}
						is_controlled_by = PREV.PREV
					}
					add_to_array = { array = PREV.PREV.states_to_transfer value = THIS.id }
					remove_core_of = ROOT
				}
			}
			if = {
				limit = {
					ROOT = { has_variable = country_name_to_show }
				}
				FROM = { 
					#white_peace = var:ROOT.country_name_to_show
					create_wargoal = {
						type = topple_government
						target = var:ROOT.country_name_to_show
						expire = 320
					}					
				}				
				var:ROOT.country_name_to_show = {
					add_opinion_modifier = { target = ROOT modifier = protest_action_strong }
					if = {
						limit = {
							has_government = colonial
						}
						hold_election = THIS
						news_event = cw_colonial_news_events.3
					}
				}
				ROOT = { end_puppet = var:ROOT.country_name_to_show }
			}			
			FROM = { white_peace = ROOT }
			country_event = { id = setup_event.6 days = 5 }		# Used to transfer states
			ROOT = {
				add_popularity = { ideology = ROOT popularity = -0.2 }
				add_stability = -0.15
				clear_variable = country_name_to_show 
			}
		}
		reject_effect = {
			ROOT = { clear_variable = country_name_to_show }
		}
		ai_desire = {
			base = -75
			modifier = {
				NOT = { is_neighbor_of = ROOT }
				add = 20
			}
			modifier = {
				add = 50
				ROOT = { check_variable = { war_exaustion_effect < -0.5 } }
			}
			modifier = {
				add = 50
				ROOT = { check_variable = { war_exaustion_effect < -1.0 } }
			}			
			modifier = {
				add = -50
				ROOT = { has_war_support > 0.5 }
			}
			modifier = {
				add = 20
				ROOT = { has_war_support < 0.20 }
			}			
			modifier = {
				ROOT = { casualties > 50000 }
				add = 5
			}
			modifier = {
				ROOT = { casualties > 100000 }
				add = 5
			}
			modifier = {
				ROOT = { casualties > 200000 }
				add = 10
			}
			modifier = {
				ROOT = { 
					casualties > 500000
					has_government = democratic
				}
				add = 30
			}
			modifier = {
				ROOT = { 
					casualties > 500000
					has_government = democratic_socialist
				}
				add = 50
			}
			modifier = {
				ROOT = { casualties > 1000000 }
				add = 50
			}
			modifier = {
				ROOT = { has_defensive_war_with = FROM }
				add = 20
			}
		}
		ai_acceptance = {
			base_desire = {
				modifier = {
					add = 10
				}			
			}
			surrender_progress = {
				modifier = {
					ROOT = { surrender_progress < 0.50 }
					add = 50
				}
			}
			their_casualties = {
				modifier = {
					FROM = { casualties > 50000 }
					add = 5
				}
				modifier = {
					FROM = { casualties > 100000 }
					add = 5
				}
				modifier = {
					FROM = { casualties > 200000 }
					add = 10
				}
				modifier = {
					FROM = { casualties > 500000 }
					add = 20
				}
				modifier = {
					FROM = { casualties > 1000000 }
					add = 30
				}
			}
			holds_our_territory = {
				modifier = {
					ROOT = { any_owned_state = { is_core_of = FROM } }
					add = 30
				}
				modifier = {
					FROM = {
						any_enemy_country = {
							is_puppet_of = ROOT
							check_variable = { twin_country = FROM.id }
						}
					}
					add = 50
				}				
			}			
		}
	}
	cw_demand_submission_communist_leader = {
		icon = 29
		allowed = {		#The country making the diplomatic request
			ROOT = { has_country_flag = communist_leader_flag }
		}
		visible = {		#The target country
			ROOT = {
				has_country_flag = communist_leader_flag
				is_major = yes
			}
			has_government = ROOT
			is_major = no
			NOT = {
				has_country_flag = recently_released_puppet
				OR = {
					is_subject_of = ROOT
					is_puppet_of = ROOT
				}
			}
		}
		
		cost = 0 
		
		selectable = {
			has_government = ROOT
			has_war = no
	
			custom_trigger_tooltip = {
				tooltip = "DEMAND_SUBMISSION_TRIGGET_TT"
				NOT = { has_idea = soviet_hatred }
				OR = {
					AND = {
						ROOT = { has_government = communism_totalitarian }
						communism_totalitarian > 0.6
					}
					AND = {
						ROOT = { has_government = communism }
						communism > 0.6
					}
				}
			}
			custom_trigger_tooltip = {
				tooltip = "Did not recently become fully independent."
				NOT = { has_country_flag = recent_independence }
			}			
			OR = {
				is_neighbor_of = ROOT
				any_home_area_neighbor_country = {
					OR = {
						is_subject_of = ROOT
						is_puppet_of = ROOT
					}
				}
			}		
			ROOT = { strength_ratio = { tag = PREV ratio > 0.5 } }
			ROOT = { ic_ratio = { tag = PREV ratio > 0.5 } }
			ROOT = { has_country_flag = cominform_created }
		}
		can_be_accepted = {
			always = yes
		}
		can_be_sent = {
			always = yes
		}

		send_description = CW_DEMAND_SUBMISSION_COMMUNIST_LEADER_LOC
		receive_description = CW_DEMAND_SUBMISSION_COMMUNIST_LEADER_RECIEVER_LOC
		accept_title = CW_DEMAND_SUBMISSION_COMMUNIST_LEADER_ACCEPTED_TITLE
		accept_description = CW_DEMAND_SUBMISSION_COMMUNIST_LEADER_ACCEPTED_DESC
		reject_title = CW_DEMAND_SUBMISSION_COMMUNIST_LEADER_TITLE
		reject_description = CW_DEMAND_SUBMISSION_COMMUNIST_LEADER_DESC

		requires_acceptance = yes
		show_acceptance_on_action_button = yes

		on_sent_effect = {
			if = {
				limit = {
					ROOT = { is_ai = yes }
				}
				ROOT = { set_country_flag = { flag = did_diplomatic_action value = 1 days = 30 } }
			}
		}
		complete_effect = {
			ROOT = { puppet = PREV }
			ROOT = {
				add_opinion_modifier = {
					target = PREV
					modifier = accepted_demand
				}
			}
			if = {
				limit = {
					capital_scope = { is_on_continent = europe }
				}
				add_ideas = { cw_populatioin_loss_low }				
			}
			if = {
				limit = {
					has_country_flag = assasinate_country_leader_allowed
				}
				clr_country_flag = assasinate_country_leader_allowed
			}
		}
		reject_effect = {
			ROOT = {
				add_opinion_modifier = {
					target = PREV
					modifier = refused_demand
				}
				create_wargoal = {
					type = topple_government
					target = PREV
				}
			}
			PREV = {
				add_opinion_modifier = {
					target = ROOT
					modifier = increased_tensions
				}
			}			
		}
		ai_desire = {
			base = 1
			modifier = {
				is_neighbor_of = ROOT
				add = 100
			}
			modifier = {
				capital_scope = { is_on_continent = europe }
				add = 100
			}
			#modifier = {
			#	NOT = { capital_scope = { is_on_continent = europe } }
			#	add = -100
			#}			
			modifier = {
				ROOT = {
					has_country_flag = did_diplomatic_action
				}
				add = -1000
			}				
		}
		ai_acceptance = {
			base_desire = {
				modifier = {
					add = -5
				}
				modifier = {
					ROOT = { has_added_tension_amount > 50 }
					add = -10
				}				
				modifier = {
					ROOT = { has_added_tension_amount > 50 }
					add = -10
				}
				modifier = {
					OR = { has_government = neutrality has_government = unaligned_right }
					ROOT = { has_added_tension_amount < 50 }
					add = 40
				}
				modifier = {
					has_country_leader_with_trait = fiercely_independent
					add = -100
				}
			}
			relation_checks = {
				modifier = {
					has_opinion = { target = ROOT value < 5 }
					add = -10
				}
				modifier = {
					has_opinion = { target = ROOT value < -50 }
					add = -50
				}				
				modifier = {
					has_opinion = { target = ROOT value > 9 }
					add = 5
				}
				modifier = {
					has_opinion = { target = ROOT value > 20 }
					add = 10
				}				
				modifier = {
					has_opinion = { target = ROOT value > 50 }
					add = 20
				}
				modifier = {
					has_war_with = ROOT
					add = -100
				}
				modifier = {
					ROOT = { any_owned_state = { is_core_of = PREV.PREV } }
					add = -120
				}
				modifier = {
					any_owned_state = { is_claimed_by = ROOT }
					add = -75
				}					
				modifier = {
					has_volunteers_amount_from = {
						tag = ROOT
						count > 1
					}
					add = 20					
				}				
				modifier = {
					is_in_array = {
						array = ROOT.embargoed_countries
						value = FROM.id
					}
					add = -100
				}				
			}
			ideology_checks = {
				modifier = {
					PREV = { similar_ideology_check = no }
					add = -80
				}	
				modifier = {
					PREV = { similar_ideology_check = no }
					add = 20
				}						
				modifier = {
					same_ideology_check = yes
					NOT = { OR = { has_government = neutrality has_government = unaligned_right } }					
					add = 20
				}
				modifier = {
					same_ideology_check = no
					NOT = { OR = { has_government = neutrality has_government = unaligned_right } }					
					add = -50
				}					
				modifier = {
					PREV = { similar_ideology_check = no }
					ROOT = { is_ai = yes }
					add = 200
				}				
			}
			diplomatic_checks = {
				modifier = {
					ROOT = { OR = { has_country_flag = democratic_leader has_country_flag = communist_leader has_country_flag = neutral_leader } }
					add = 10
				}				
				modifier = {
					ROOT = {
						is_in_array = {
							array = global.unsc_permanent_members_array
							value = THIS.id
						}
					}
					add = 10
				}				
				modifier = {
					ROOT = {
						is_in_array = {
							array = global.unsc_non_permanent_members_array
							value = THIS.id
						}
					}
					add = 20
				}				
			}
			military_checks = {
				modifier = {
					is_neighbor_of = ROOT
					strength_ratio = { tag = ROOT ratio < 1 }
					add = 20
				}
				modifier = {
					NOT = { is_neighbor_of = ROOT }
					strength_ratio = { tag = ROOT ratio < 1 }
					add = -1
				}
			}
		}
	}
	cw_abandon_communist_puppet = {
		allowed = {}
		
		visible = {
			ROOT = {
				OR = {
					has_government = communism
					has_government = communism_totalitarian
				}
			}
			OR = {
				is_puppet_of = ROOT
				is_subject_of = ROOT
			}
		}
		
		cost = 100
		
		selectable = {
			ROOT = {
				OR = {
					has_government = communism
					has_government = communism_totalitarian
				}
			}
			OR = {
				is_puppet_of = ROOT
				is_subject_of = ROOT
			}
			has_civil_war_cwtrigger = no
		}
		can_be_accepted = {
			always = yes
		}
		can_be_sent = {
			always = yes
		}

		send_description = CW_ABANDON_COMMUNIST_PUPPET_LOC
		accept_title = CW_ABANDON_COMMUNIST_PUPPET_ACCEPT_TITLE
		accept_description = CW_ABANDON_COMMUNIST_PUPPET_ACCEPT_DESC

		requires_acceptance = no
		
		complete_effect = {
			ROOT = { end_puppet = PREV }
			add_timed_idea = { idea = ideological_differences days = 90 }
			set_country_flag = { flag = recently_released_puppet value = 1 days = 1825 }
			hidden_effect = {
				if = {
					limit = {
						has_government = colonial
						has_civil_war_cwtrigger = no
					}
					random_list = {
						25 = {
							start_civil_war = {
								ruling_party = ROOT
								ideology = neutrality
								size = 0.5
								states_filter = { impassable = no }
								compute_proxy_score = yes
							}
							compute_proxy_score = yes
						}						
						25 = {
							start_civil_war = {
								ruling_party = unaligned_right
								ideology = neutrality
								size = 0.5
								states_filter = { impassable = no }
								compute_proxy_score = yes
							}
							compute_proxy_score = yes
						}
						25 = {
							start_civil_war = {
								ruling_party = ROOT
								ideology = unaligned_right
								size = 0.5
								states_filter = { impassable = no }
								compute_proxy_score = yes
							}
							compute_proxy_score = yes
						}
						0 = {
							start_civil_war = {
								ruling_party = communism_totalitarian
								ideology = communism
								keep_political_leader = yes
								size = 0.2
								states_filter = { impassable = no }
								compute_proxy_score = yes
							}
							compute_proxy_score = yes
							modifier = {
								factor = 50
								SOV = { has_government = communism }
							}
						}												
					}
				}
			}
		}
		ai_desire = {
			base = 0
			modifier = {
				add = 100
				ROOT = {
					OR = {
						has_government = communism
						has_government = communism_totalitarian
					}
				}
				has_government = colonial
				NOT = { tag = PRK }
			}
		}
	}
	cw_recall_volunteers = {
		icon = 29
		allowed = {		#The country making the diplomatic request
		}
		visible = {		#The target country
			has_volunteers_amount_from = {
				tag = ROOT
				count > 0
			}
		}
		
		cost = 0
		
		selectable = {
			has_volunteers_amount_from = {
				tag = ROOT
				count > 0
			}
		}

		can_be_sent = {
			always = yes
		}

		send_description = CW_RECALL_VOLUNTEERS_LOC
		#receive_description = CW_DEMAND_SUBMISSION_COMMUNIST_LEADER_RECIEVER_LOC

		requires_acceptance = no
		show_acceptance_on_action_button = no

		on_sent_effect = {
			if = {
				limit = {
					ROOT = { is_ai = yes }
				}
				ROOT = { set_country_flag = { flag = did_diplomatic_action value = 1 days = 30 } }
			}
		}
		complete_effect = {
			ROOT = { recall_volunteers_from = PREV }
			add_opinion_modifier = {
				target = ROOT
				modifier = suspended_military_aid
			}
			
			#if its soviet volunteers
			if = {
				limit = {
					ROOT = {
						OR = {
							has_government = communism_totalitarian
							has_government = communism
						}
					}
				}
				
				if = {
					limit = {
						ROOT  = { original_tag = SOV }
					 }

					news_event  = {
						id = cw_proxy_war.1
						days = 1
					}
					
					PREV = {
						clr_country_flag = sov_volunteers
						set_country_flag = sov_retreat
					}
				}
				else = {
					news_event  = {
						id = cw_proxy_war.5
						days = 1
					}
				}
			
			}
			#if its usa volunteers
			if = {
			
				limit = {
					ROOT = {
						NOT = {
							OR = {
								has_government = communism
								has_government = communism_totalitarian
							}
						}
					}
				
				}
				if = {
					limit = {
						ROOT  = { original_tag = USA }
					 }

						news_event  = {
							id = cw_proxy_war.3
							days = 1
						}
					
					PREV = {
						
						clr_country_flag = usa_volunteers
						set_country_flag = usa_retreat
					}
				}
				
				else = {
					news_event  = {
						id = cw_proxy_war.7
						days = 1
					}
				}
			
			}
		}
		
		ai_desire = {
			base = 0
			modifier = {
				add = 500
				any_enemy_country = { has_government = ROOT }
			}
		}
	}
	cw_trade_agreement = {
		icon = 30
		allowed = {
		}
		visible = {
			ROOT = {
				is_ai = no 
				OR = {
					has_government = communism_totalitarian
					has_government = communism
				}
			}
			OR = {
				has_government = communism_totalitarian
				has_government = communism
			}
		}
		
		selectable = {
		}
		can_be_accepted = {
			always = yes
		}
		can_be_sent = {
			always = yes
		}
		
		cost = 100

		send_description = CW_TRADE_AGREEMENT_LOC
		receive_description = CW_TRADE_AGREEMENT_LOC_RECIEVER_LOC
		accept_title = CW_TRADE_AGREEMENT_ACCEPTED_TITLE
		accept_description = CW_TRADE_AGREEMENT_ACCEPTED_DESC
		reject_title = CW_TRADE_AGREEMENT_REJECTED_TITLE
		reject_description = CW_TRADE_AGREEMENT_REJECTED_DESC

		requires_acceptance = yes
		show_acceptance_on_action_button = yes

		on_sent_effect = {
		}
		complete_effect = {
			add_opinion_modifier = { target = ROOT modifier = cw_trade_agreement }
			add_opinion_modifier = { target = ROOT modifier = cw_trade_agreement_trade }
            activate_targeted_decision = { target = ROOT decision = cw_mission_trade_agreement }
			ROOT = {
				add_to_array = {
					array = FROM.active_trade_deals
					value = THIS.id
				}
			}
		}
		reject_effect = {
		}
		ai_desire = {
			modifier = {
				ROOT = { has_country_flag = did_diplomatic_action_embargo }
				add = -500
			}		
		}
		ai_acceptance = {
			base_desire = {
				modifier = {
					add = -5
				}
				modifier = {
					add = -25
					AND = {
						ROOT = {
							OR = {
								has_government = communism
								has_government = communism_totalitarian
							}
						}
						OR = {
							has_country_leader_with_trait = absolute_monarch
							has_country_leader_with_trait = stern_anti_communist
						}
					}
				}
			}
			relation_checks = {
				modifier = {
					has_opinion = { target = ROOT value < 5 }
					add = -10
				}
				modifier = {
					has_opinion = { target = ROOT value < -50 }
					add = -50
				}				
				modifier = {
					has_opinion = { target = ROOT value > 9 }
					add = 5
				}
				modifier = {
					has_opinion = { target = ROOT value > 20 }
					add = 10
				}				
				modifier = {
					has_opinion = { target = ROOT value > 50 }
					add = 20
				}
				modifier = {
					has_war_with = ROOT
					add = -100
				}
				modifier = {
					ROOT = { any_owned_state = { is_core_of = PREV.PREV } }
					add = -120
				}
				modifier = {
					any_owned_state = { is_claimed_by = ROOT }
					add = -75
				}					
				modifier = {
					has_volunteers_amount_from = {
						tag = ROOT
						count > 1
					}
					add = 20					
				}				
				modifier = {
					is_in_array = {
						array = ROOT.embargoed_countries
						value = FROM.id
					}
					add = -100
				}				
			}
			aggressives_checks = {
				modifier = {
					ROOT = { is_ai = no }
					OR = {
						has_government = neutrality
						has_government = unaligned_right
					}
					ROOT = { has_added_tension_amount > 5 }
					add = -5
				}
				modifier = {
					ROOT = { is_ai = no }
					OR = {
						has_government = neutrality
						has_government = unaligned_right
					}
					ROOT = { has_added_tension_amount > 50 }
					add = -10
				}				
			}			
			ideology_checks = {
				modifier = {
					PREV = { similar_ideology_check = no }
					NOT = { OR = { has_government = neutrality has_government = unaligned_right } }
					add = -50
				}	
				modifier = {
					PREV = { similar_ideology_check = yes }
					NOT = { OR = { has_government = neutrality has_government = unaligned_right } }						
					add = 20
				}
				modifier = {
					same_ideology_check = yes
					NOT = { OR = { has_government = neutrality has_government = unaligned_right } }					
					add = 20
				}
				modifier = {
					same_ideology_check = no
					NOT = { OR = { has_government = neutrality has_government = unaligned_right } }					
					add = -50
				}					
				modifier = {
					PREV = { similar_ideology_check = no }
					ROOT = { is_ai = yes }
					add = 200
				}				
			}
			diplomatic_checks = {
				modifier = {
					ROOT = { OR = { has_country_flag = democratic_leader has_country_flag = communist_leader has_country_flag = neutral_leader } }
					add = 10
				}				
				modifier = {
					ROOT = {
						is_in_array = {
							array = global.unsc_permanent_members_array
							value = THIS.id
						}
					}
					add = 15
				}				
				modifier = {
					ROOT = {
						is_in_array = {
							array = global.unsc_non_permanent_members_array
							value = THIS.id
						}
					}
					add = 10
				}				
			}
			military_checks = {
				modifier = {
					is_neighbor_of = ROOT
					strength_ratio = { tag = ROOT ratio < 1 }
					add = 75
				}
				modifier = {
					is_neighbor_of = ROOT
					ROOT = { is_major = yes }
					add = 20
				}				
				modifier = {
					NOT = { is_neighbor_of = ROOT }
					strength_ratio = { tag = ROOT ratio < 1 }
					add = -1
				}
			}
		}
	}
	cw_lease_territory = {
		icon = 31
		allowed = {
			NOT = { ROOT = { has_country_flag = diplo_gui_no_selection_timer } }
		}
		visible = {
			ROOT = { is_major = yes }
			any_owned_state = {
				is_capital = no 
				OR = {
					is_island_state = yes
					has_state_category = natural_harbour
					has_state_flag = international_lease_allowed
				}
				is_fully_controlled_by = FROM 
			}
		}
		
		selectable = {
			has_war = no
			custom_trigger_tooltip = {
				tooltip = CW_LEASE_TERRITORY_IS_FULLY_INDEPENDENT
				if = {
					limit = {
						NOT = {
							OR = {
								is_puppet_of = ROOT
								is_subject_of = ROOT
							}
						}
					}
					is_puppet = no
					is_subject = no
				}
			}
			custom_trigger_tooltip = {
				tooltip = CW_LEASE_TERRITORY_HAS_LEASABLE_TERRITORY
				any_owned_state = {
					is_capital = no 
					OR = {
						is_island_state = yes
						has_state_category = natural_harbour
						has_state_flag = international_lease_allowed
					}
					is_fully_controlled_by = FROM 
				}
			}
			custom_trigger_tooltip = {
				tooltip = CW_LEASE_TERRITORY_BUSY_NEGOTIATING
				OR = {
					NOT = { has_variable = diplomatic_gui_busy }
					check_variable = { diplomatic_gui_busy = ROOT.id }
				}
			}
			custom_trigger_tooltip = {
				tooltip = CW_LEASE_TERRITORY_HAS_FACTORIES_TO_PAY
				ROOT = { num_of_civilian_factories_available_for_projects > 4 }
			}			
		}
		can_be_accepted = {
			always = no
		}
		can_be_sent = {
			OR = {
				ROOT = { has_country_flag = diplo_gui_no_selection }
				ROOT = {
					check_variable = { requested_leases > 0 }
					var:requested_state_lease = { check_variable = { requested_lease_period > 0 } }
					num_of_civilian_factories_available_for_projects > var:ROOT.requested_lease_cost
				}
				
			}
			
		}

		reset_send_effect = {
			ROOT = {
				clear_variable = requested_leases
				set_country_flag = lease_negotiations
				set_country_flag = diplo_gui_no_selection
			}
			FROM = {
				set_variable = { diplomatic_gui_busy = ROOT.id }
				clear_array = THIS.lease_eligable_states
				every_controlled_state = {
					limit = {
						OR = {
							is_island_state = yes
							has_state_category = natural_harbour
							has_state_flag = international_lease_allowed
						}
						is_core_of = PREV
						is_fully_controlled_by = PREV
						is_capital = no
					}
					add_to_array = {
						array = PREV.lease_eligable_states
						value = THIS.id
					}
					if = {
						limit = {
							has_state_flag = lease_requested_state
						}
						clr_state_flag = lease_requested_state
					}
				}
			}
		}		
		send_scripted_gui = cw_lease_territory_diplomacy
		receive_description = CW_LEASE_TERRITORY_LOC_RECIEVER_LOC
		accept_title = CW_LEASE_TERRITORY_ACCEPTED_TITLE
		accept_description = CW_LEASE_TERRITORY_ACCEPTED_DESC
		reject_title = CW_LEASE_TERRITORY_REJECTED_TITLE
		reject_description = CW_LEASE_TERRITORY_REJECTED_DESC

		requires_acceptance = yes
		show_acceptance_on_action_button = yes

		on_sent_effect = {
			if = {
				limit = {
					OR = {
						ROOT = { has_country_flag = diplo_gui_no_selection }
					}
				}
				ROOT = { 
					set_country_flag = { flag = diplo_gui_no_selection_timer value = 1 days = 1 }		#Used to prevent sending an accepted/rejected popup if no selection was made
					clr_country_flag = diplo_gui_no_selection
				}
				
				ROOT = {
				clear_variable = requested_leases
				set_country_flag = lease_negotiations
				set_country_flag = diplo_gui_no_selection
			}
			FROM = {
				set_variable = { diplomatic_gui_busy = ROOT.id }
				clear_array = THIS.lease_eligable_states
				every_controlled_state = {
					limit = {
						OR = {
							is_island_state = yes
							has_state_category = natural_harbour
							has_state_flag = international_lease_allowed
						}
						is_core_of = PREV
						is_fully_controlled_by = PREV
						is_capital = no
					}
					add_to_array = {
						array = PREV.lease_eligable_states
						value = THIS.id
					}
					if = {
						limit = {
							has_state_flag = lease_requested_state
						}
						clr_state_flag = lease_requested_state
					}
				}
			}
				
			}
		}
		complete_effect = {	
			clear_variable = diplomatic_gui_busy
			if = {
				limit = {
					ROOT = { has_country_flag = diplo_gui_no_selection }
				}
				ROOT = { clr_country_flag = diplo_gui_no_selection }
				else = {
					ROOT = {
						cw_grant_lease_diplomatic_action = yes 
						clear_variable = requested_lease_cost
						clear_variable = requested_lease_period
						clear_variable = requested_leases
					}
				}
			}
		}
		reject_effect = {
			if = {
				limit = {
					ROOT = { has_country_flag = diplo_gui_no_selection }
				}
				ROOT = { clr_country_flag = diplo_gui_no_selection }
			}
			clear_variable = diplomatic_gui_busy
			clear_variable = requested_lease_cost
			clear_variable = requested_lease_period
			clear_variable = requested_leases
		}
		ai_desire = {		
		}
		ai_acceptance = {
			base_desire = {
				modifier = {
					add = 5
				}
				modifier = {
					has_idea = unstable_government
					add = 15
				}
				modifier = {
					check_variable = { leased_territory > 0 }
					add = -50
				}
				modifier = {
					check_variable = { leased_territory > 1 }
					add = -150
				}
				modifier = {
					check_variable = { leased_territory > 2 }
					add = -500
				}
				
				modifier = {
					AND = {
						ROOT = { is_ideology_leader = yes }
						FROM = { is_ideology_leader = yes }
					}
					add = -500
				}
			}
			relation_checks = {
				modifier = {
					has_opinion = { target = ROOT value < 0 }
					add = -1000
				}		

				
				modifier = {
					has_opinion = { target = ROOT value < 5 }
					add = -10
				}
				modifier = {
					has_opinion = { target = ROOT value < -50 }
					add = -50
				}				
				modifier = {
					has_opinion = { target = ROOT value > 9 }
					add = 5
				}
				modifier = {
					has_opinion = { target = ROOT value > 20 }
					add = 10
				}				
				modifier = {
					has_opinion = { target = ROOT value > 50 }
					add = 20
				}
				modifier = {
					has_war_with = ROOT
					add = -100
				}
				modifier = {
					ROOT = { any_owned_state = { is_core_of = PREV.PREV } }
					add = -120
				}
				modifier = {
					any_owned_state = { is_claimed_by = ROOT }
					add = -75
				}					
				modifier = {
					has_volunteers_amount_from = {
						tag = ROOT
						count > 1
					}
					add = 20					
				}				
				modifier = {
					is_in_array = {
						array = ROOT.embargoed_countries
						value = FROM.id
					}
					add = -100
				}				
			}			
			wants_economic_help = {
				modifier = {
					num_of_civilian_factories < 10
					add = 20
				}
				modifier = {
					capital_scope = { is_on_continent = africa }
					add = 20
				}
				modifier = {
					capital_scope = { is_on_continent = south_america }
					add = 10
				}
			}
			ideology_checks = {
				modifier = {
					AND = {
						PREV = { similar_ideology_check = no }
						NOT = {
							OR = {
								is_puppet_of = ROOT
								is_subject_of = ROOT
							}
						}
					}
					add = -1000
				}	
				modifier = {
					PREV = { similar_ideology_check = yes }
					add = 20
				}
				modifier = {
					same_ideology_check = yes
					add = 20
				}
				modifier = {
					same_ideology_check = no
					add = -50
				}
			}
			military_checks = {
				modifier = {
					is_neighbor_of = ROOT
					strength_ratio = { tag = ROOT ratio < 1 }
					add = 75
				}
				modifier = {
					is_neighbor_of = ROOT
					ROOT = { is_major = yes }
					add = 20
				}				
				modifier = {
					NOT = { is_neighbor_of = ROOT }
					strength_ratio = { tag = ROOT ratio < 1 }
					add = -1
				}
			}
		}
	}
	cw_request_state_monopoly = {
		icon = 32
		allowed = {
			NOT = { ROOT = { has_country_flag = diplo_gui_no_selection_timer } }
		}
		visible = {
			ROOT = { is_major = yes }
			NOT = { is_puppet_of = ROOT }
			if = {
				limit = {
					OR = {
						has_government = communism
						has_government = communism_totalitarian
					}
				}
				ROOT = {
					OR = {
						has_government = communism
						has_government = communism_totalitarian
					}
				}
			}
			any_owned_state = {
				is_capital = no
				OR = {
					check_variable = {
						resource@oil > 10
					}
					check_variable = {
						resource@steel > 10
					}
					check_variable = {
						resource@tungsten > 10
					}
					check_variable = {
						resource@aluminium > 10
					}
					check_variable = {
						resource@chromium > 10
					}
					
					check_variable = {
						resource@uranium > 0
					}
				}
			}
			OR = {
				NOT = { has_government = communism }
				NOT = { has_government = communism_totalitarian }
			}			
		}
		
		cost = 50
		
		selectable = {
			has_war = no
			custom_trigger_tooltip = {
				tooltip = CW_LEASE_TERRITORY_IS_FULLY_INDEPENDENT
				is_puppet = no
				is_subject = no
			}			
			custom_trigger_tooltip = {
				tooltip = CW_MONOPOLY_BUSY_NEGOTIATING
				OR = {
					NOT = { has_variable = diplomatic_gui_busy }
					check_variable = { diplomatic_gui_busy = ROOT.id }
				}
			}
			custom_trigger_tooltip = {
				tooltip = CW_MONOPOLY_NATIONALIZED_FOREIGN_ASSETS
				NOT = { has_country_flag = nationalized_foreign_companies }
			}
		}
		can_be_accepted = {
			always = no
		}
		can_be_sent = {
			OR = {
				ROOT = { has_country_flag = diplo_gui_no_selection }
				ROOT = {
					check_variable = { requested_monopolies > 0 }
					var:requested_state_monopoly = { check_variable = { requested_monopoly_period > 0 } }
				}
			}
		}

		reset_send_effect = {
			ROOT = {
				clear_variable = requested_monopolies
				set_country_flag = monopoly_negotiations
				set_country_flag = diplo_gui_no_selection
			}
			FROM = {
				set_variable = { diplomatic_gui_busy = ROOT.id }
				clear_array = THIS.monopoly_eligable_states
				every_controlled_state = {
					limit = {
						is_fully_controlled_by = PREV
						is_core_of = PREV
						is_capital = no
						NOT = { has_state_flag = monopoly_state }
						OR = {
							has_state_flag = high_resource_potential_oil
							has_resources_amount = {
								resource = oil
								amount > 0
							}
							has_resources_amount = {
								resource = steel
								amount > 0
							}
							has_resources_amount = {
								resource = tungsten
								amount > 0
							}
							has_resources_amount = {
								resource = aluminium
								amount > 0
							}
							has_resources_amount = {
								resource = chromium
								amount > 0
							}
							
							has_resources_amount = {
								resource = uranium
								amount > 0
							}
						}
					}
					add_to_array = {
						array = PREV.monopoly_eligable_states
						value = THIS.id
					}
					if = {
						limit = {
							has_state_flag = monopoly_requested_state
						}
						clr_state_flag = monopoly_requested_state
					}
				}
			}
		}		
		send_scripted_gui = cw_state_monopoly_diplomacy
		receive_description = CW_STATE_MONOPOLY_LOC_RECIEVER_LOC
		accept_title = CW_STATE_MONOPOLY_ACCEPTED_TITLE
		accept_description = CW_STATE_MONOPOLY_ACCEPTED_DESC
		reject_title = CW_STATE_MONOPOLY_REJECTED_TITLE
		reject_description = CW_STATE_MONOPOLY_REJECTED_DESC

		requires_acceptance = yes
		show_acceptance_on_action_button = yes

		on_sent_effect = {
			if = {
				limit = {
					OR = { 
						ROOT = { has_country_flag = diplo_gui_no_selection }
					}
				}
				ROOT = { 
					set_country_flag = { flag = diplo_gui_no_selection_timer value = 1 days = 1 }		#Used to prevent sending an accepted/rejected popup if no selection was made
					clr_country_flag = diplo_gui_no_selection
				}
				
				ROOT = {
				clear_variable = requested_monopolies
				set_country_flag = monopoly_negotiations
				set_country_flag = diplo_gui_no_selection
			}
			FROM = {
				set_variable = { diplomatic_gui_busy = ROOT.id }
				clear_array = THIS.monopoly_eligable_states
				every_controlled_state = {
					limit = {
						is_fully_controlled_by = PREV
						is_core_of = PREV
						is_capital = no
						NOT = { has_state_flag = monopoly_state }
						OR = {
							has_state_flag = high_resource_potential_oil
							has_resources_amount = {
								resource = oil
								amount > 0
							}
							has_resources_amount = {
								resource = steel
								amount > 0
							}
							has_resources_amount = {
								resource = tungsten
								amount > 0
							}
							has_resources_amount = {
								resource = aluminium
								amount > 0
							}
							has_resources_amount = {
								resource = chromium
								amount > 0
							}
							
							has_resources_amount = {
								resource = uranium
								amount > 0
							}
						}
					}
					add_to_array = {
						array = PREV.monopoly_eligable_states
						value = THIS.id
					}
					if = {
						limit = {
							has_state_flag = monopoly_requested_state
						}
						clr_state_flag = monopoly_requested_state
					}
				}
			}
				
			}
		}
		complete_effect = {
			clear_variable = diplomatic_gui_busy
			if = {
				limit = {
					ROOT = { has_country_flag = diplo_gui_no_selection }
				}
				ROOT = { clr_country_flag = diplo_gui_no_selection }
				else = {
					var:ROOT.requested_state_monopoly = { cw_grant_monopoly_diplomacy = yes }
					ROOT = {
						clear_variable = requested_monopoly_cost
						clear_variable = requested_monopolies
					}
					FROM = {
						every_owned_state = {
						  limit = {
							is_in_array = {
								array = PREV.monopoly_eligable_states
								value = THIS.id
							}
						  }
						  clr_state_flag = monopoly_requested_state
						  clr_state_flag = binding_monopoly
						  clear_variable = requested_monopoly_period
						}
					}
				}
			}
		}
		reject_effect = {
			if = {
				limit = {
					ROOT = { has_country_flag = diplo_gui_no_selection }
				}
				ROOT = { clr_country_flag = diplo_gui_no_selection }
			}
			clear_variable = diplomatic_gui_busy
			clear_variable = requested_monopoly_cost
			clear_variable = requested_monopoly_period
			clear_variable = requested_monopolies
		}
		ai_desire = {
		}
		ai_acceptance = {
			base_desire = {
				modifier = {
					add = 5
				}
				modifier = {
					has_idea = unstable_government
					add = 100
				}
				modifier = {
					check_variable = { total_monopolies > 0 }
					add = -50
				}
				modifier = {
					check_variable = { total_monopolies > 1 }
					add = -150
				}
				modifier = {
					check_variable = { total_monopolies > 2 }
					add = -500
				}
				modifier = {
					AND = {
						ROOT = { is_ideology_leader = yes }
						FROM = { is_ideology_leader = yes }
					}
					add = -500
				}
			}
			relation_checks = {
				modifier = {
					has_opinion = { target = ROOT value < 0 }
					add = -150
				}			
				modifier = {
					has_opinion = { target = ROOT value < 5 }
					add = -10
				}
				modifier = {
					has_opinion = { target = ROOT value < -50 }
					add = -50
				}				
				modifier = {
					has_opinion = { target = ROOT value > 9 }
					add = 5
				}
				modifier = {
					has_opinion = { target = ROOT value > 20 }
					add = 10
				}				
				modifier = {
					has_opinion = { target = ROOT value > 50 }
					add = 20
				}
				modifier = {
					has_war_with = ROOT
					add = -1000
				}
				modifier = {
					ROOT = { any_owned_state = { is_core_of = PREV.PREV } }
					add = -120
				}
				modifier = {
					any_owned_state = { is_claimed_by = ROOT }
					add = -75
				}					
				modifier = {
					has_volunteers_amount_from = {
						tag = ROOT
						count > 1
					}
					add = 20					
				}				
				modifier = {
					is_in_array = {
						array = ROOT.embargoed_countries
						value = FROM.id
					}
					add = -100
				}				
			}			
			wants_economic_help = {
				modifier = {
					num_of_civilian_factories < 10
					add = 20
				}
				modifier = {
					capital_scope = { is_on_continent = africa }
					add = 20
				}
				modifier = {
					capital_scope = { is_on_continent = south_america }
					add = 10
				}
			}
			ideology_checks = {
				modifier = {
					PREV = { similar_ideology_check = no }
					add = -100
				}	
				modifier = {
					PREV = { similar_ideology_check = yes }
					add = 20
				}
				modifier = {
					same_ideology_check = yes
					add = 20
				}
				modifier = {
					same_ideology_check = no
					add = -50
				}
			}
			military_checks = {
				modifier = {
					is_neighbor_of = ROOT
					strength_ratio = { tag = ROOT ratio < 1 }
					add = 75
				}
				modifier = {
					is_neighbor_of = ROOT
					ROOT = { is_major = yes }
					add = 20
				}				
				modifier = {
					NOT = { is_neighbor_of = ROOT }
					strength_ratio = { tag = ROOT ratio < 1 }
					add = -1
				}
			}
		}
	}
}